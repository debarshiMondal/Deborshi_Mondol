<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>{{PAGE_TITLE}}</title>
<style>
  :root{
    --blue:#1d4ed8; --blue-quiet:#eaf2ff; --blue-deep:#1e40af;
    --green:#16a34a; --green-quiet:#e8f7ee;
    --orange:#d97706; --orange-quiet:#fff4e5;
    --red:#dc2626;   --red-quiet:#fde8e8;
    --gray:#6b7280;  --ink:#0b0f19; --line:#e6e9ef; --bg:#f8fafc; --white:#fff;
    --radius:14px; --shadow:0 8px 24px rgba(0,0,0,.08),0 2px 6px rgba(0,0,0,.06);
  }
  *,*::before,*::after{box-sizing:border-box}

  /* Page structure: footer at end */
  html, body { height:100%; }
  html{ scroll-behavior:smooth; }
  body{
    margin:0;background:var(--bg);color:var(--ink);
    font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;
    display:flex;flex-direction:column;min-height:100vh;
  }
  h1,h2{margin:0 0 12px 0;font-weight:900}
  h2{font-size:18px}
  p{margin:0}
  a{color:inherit}

  /* Header */
  header{
    background:linear-gradient(135deg,#0b0f19 0%,var(--blue-deep) 100%);
    color:#fff; box-shadow:var(--shadow);
  }
  .h-inner{max-width:1100px;margin:0 auto;padding:14px 18px;display:flex;align-items:center;justify-content:space-between;gap:12px}
  .h-title{display:flex;flex-direction:column;gap:6px}
  .h-title h1{margin:0;font-size:clamp(18px,2.2vw,24px);font-weight:900;letter-spacing:.2px}
  .badges{display:flex;gap:8px;flex-wrap:wrap}
  .badge{background:rgba(255,255,255,.14);border:1px solid rgba(255,255,255,.28);
         color:#fff;padding:4px 10px;border-radius:999px;font-size:12px}
  .brand{display:flex;align-items:center;gap:8px}
  .brand img{height:32px;display:block;filter:drop-shadow(0 2px 2px rgba(0,0,0,.35))}
  .back{display:inline-flex;align-items:center;gap:6px;font-weight:700;font-size:12px;
        background:rgba(255,255,255,.10);border:1px solid rgba(255,255,255,.35);
        border-radius:999px;padding:4px 8px;color:#fff;text-decoration:none}
  .back:hover{background:rgba(255,255,255,.18);text-decoration:none}

  main{max-width:1100px;margin:18px auto;padding:0 18px;flex:1 0 auto;}

  /* Cards & grid */
  .card{background:#fff;border:1px solid var(--line);border-radius:16px;box-shadow:var(--shadow);padding:18px}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
  @media (max-width:900px){ .grid{grid-template-columns:1fr} }

  .kv{display:grid;grid-template-columns:260px 1fr;gap:8px 14px}
  .kv .lbl{color:#111;font-weight:800}
  .kv .val{color:#111}
  .kv .time-badge{font-weight:800;color:#0f172a;margin-left:4px}

  /* NEW: summary link list */
  .summary-links{margin:8px 0 0 0;padding-left:18px}
  .summary-links li{margin:6px 0}
  .inline-link{color:var(--blue-deep);font-weight:800;text-decoration:none}
  .inline-link:hover{text-decoration:underline}

  /* Roles – single colorful block (reddish) */
  .roles{margin-top:14px;padding-top:14px;border-top:1px solid var(--line)}
  .roles h3{margin:0 0 10px 0;font-size:15px;font-weight:900;color:#111}
  .roles-brief{
    background:var(--red-quiet);
    border:1px solid var(--line);
    border-radius:12px;
    padding:14px;
    box-shadow:0 4px 14px rgba(0,0,0,.05);
  }
  .roles-brief ul{margin:8px 0 0 0;padding-left:18px}
  .roles-brief li{margin:4px 0;color:#111}

  /* Buttons */
  .btns{display:grid;gap:10px;grid-template-columns:repeat(2,minmax(0,1fr))}
  .btn{
       display:flex;align-items:center;justify-content:space-between;gap:12px;
       padding:12px;border-radius:12px;border:1px solid var(--line);
       background:#fff;color:inherit;text-decoration:none;transition:.15s;
       font-weight:600;font-size:12.5px;
       box-shadow:0 1px 3px rgba(0,0,0,.05);
  }
  .btn:hover{ filter:brightness(1.06); box-shadow:0 2px 6px rgba(0,0,0,.08); }
  .btn .left{display:flex;flex-direction:column}
  .btn .left strong{font-weight:800}
  .btn .count{min-width:auto;text-align:right;padding:0;border:none;background:transparent;font-weight:900;font-size:11.5px}

  .btn.green{background:var(--green-quiet)}
  .btn.orange{background:var(--orange-quiet)}
  .btn.red{background:var(--red-quiet)}
  .btn.blue{background:var(--blue-quiet)}

  .btn.green  .count{ color:var(--green);  }
  .btn.orange .count{ color:var(--orange); }
  .btn.red    .count{ color:var(--red);    }
  .btn.blue   .count{ display:none; }

  .btn-wrap{position:relative;display:flex;align-items:center;gap:8px}
  .card.action, .btns{overflow:visible;position:relative}
  .info-icon{
    font-size:12px;line-height:1;cursor:pointer;user-select:none;
    border:1px solid var(--line);border-radius:50%;width:18px;height:18px;
    display:flex;align-items:center;justify-content:center;background:var(--white);color:var(--gray);
  }
  .info-icon:hover{background:var(--blue-quiet);color:var(--blue);border-color:var(--blue)}

  .modal-mask{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;z-index:9999;padding:20px}
  .modal{background:#111;color:#fff;border-radius:12px;border:2px solid rgba(255,255,255,.9);max-width:640px;width:min(92vw,640px);padding:18px 20px;box-shadow:0 12px 28px rgba(0,0,0,.32)}
  .modal h3{margin:0 0 10px 0;font-size:16px}
  .modal p{font-size:16px;font-weight:800;line-height:1.4}
  .modal .actions{display:flex;justify-content:flex-end;margin-top:14px}
  .modal .btn-close{background:#fff;border:1px solid var(--line);color:#111;border-radius:10px;padding:8px 12px;cursor:pointer;font-weight:700}

  .grid .card.action{display:flex;flex-direction:column}
  .grid .card.action .btns{flex:1 1 auto;align-content:start}

  footer{background:#0b0f19;color:#fff;text-align:center;font-size:12px;padding:6px 10px;margin-top:24px}

  .btn{box-shadow: 0 2px 8px rgba(0,0,0,.10), 0 1px 3px rgba(0,0,0,.06);transition: transform .18s ease, box-shadow .18s ease, filter .18s ease;}
  .btn:hover{transform: translateY(-2px);box-shadow: 0 8px 22px rgba(0,0,0,.18), 0 4px 10px rgba(0,0,0,.10);filter: brightness(1.09);}
  .btn:active{transform: translateY(-1px) scale(.995);box-shadow: 0 5px 14px rgba(0,0,0,.16), 0 3px 8px rgba(0,0,0,.10);filter: brightness(1.03);}
  .btn.green:hover, .btn.orange:hover, .btn.red:hover, .btn.blue:hover { filter: brightness(1.10); }
</style>
</head>
<body>
<header>
  <div class="h-inner">
    <div class="h-title">
      <h1>{{TITLE_HEADING}}</h1>
      <div class="badges">
        <span class="badge">API Version: <strong>{{API_VERSION}}</strong></span>
        <span class="badge">Report Date: <strong>{{REPORT_DATE}}</strong></span>
      </div>
    </div>
    <div class="brand">
      <img src="{{LOGO_HREF}}" alt="Cadence logo" />
      <a class="back" href="../index.html">← Back</a>
    </div>
  </div>
</header>

<main>
  <!-- Summary -->
  <section class="card" style="margin-bottom:16px">
    <h2>Summary</h2>

    <!-- Dump labels with optional time -->
    <div class="kv">
      <div class="lbl">Previous production dump</div>
      <div class="val">{{PREVIOUS_DATE_HUMAN}}<span class="time-badge" data-time="{{PREVIOUS_TIME_HUMAN}}"></span></div>
      <div class="lbl">Latest production dump</div>
      <div class="val">{{LATEST_DATE_HUMAN}}<span class="time-badge" data-time="{{LATEST_TIME_HUMAN}}"></span></div>
    </div>

    <!-- Added the two lines -->
    <p class="note" style="margin-top:10px">
      This report compares the <strong>latest SFDC production metadata dump</strong> with the <strong>previous</strong> dump and lists <strong>all differences</strong>.
    </p>
    <p class="note" style="margin-top:6px"><strong>Changes are classified as:</strong></p>
    <ul class="summary-links">
      <li><a class="inline-link" href="#anchor-new">New files</a></li>
      <li><a class="inline-link" href="#anchor-changed">Changed files (content mismatches)</a></li>
      <li><a class="inline-link" href="#anchor-removed">Removed files</a></li>
    </ul>

    <!-- Linking lines -->
    <p class="note" style="margin-top:8px">
      Folder-wise (metadata-type) counts are available in the
      <a class="inline-link" href="#anchor-codecomp">Code Comparison Report</a>.
    </p>
    <p class="note" style="margin-top:6px">
      A consolidated diff-only <a class="inline-link" href="#anchor-codecomp">Code Comparison Report</a> and an
      <a class="inline-link" href="#anchor-log">Execution Log</a> document each run for audit and context.
    </p>
  </section>

  <!-- Roles & Responsibilities (single reddish block, bold group names) -->
  <section class="card" style="margin-bottom:16px">
    <h2>Roles & Responsibilities</h2>
    <div class="roles-brief">
      <p style="margin:0">
        <strong>Development, DevOps, and Production Support</strong> must add comments to the
        <a class="inline-link" href="#anchor-pmfr">Production Modified File Report</a> (SharePoint link) with:
      </p>
      <ul>
        <li>Ticket number (ID)</li>
        <li>Resolution date</li>
        <li>Affected module/area</li>
        <li>Details of the change</li>
      </ul>
      <p style="margin-top:6px"><strong>BSA, QA</strong> will analyze and validate the report.</p>
    </div>
  </section>

  <section class="grid" style="margin-top:16px">
    <!-- Downloads -->
    <div class="card action">
      <h2>Downloads</h2>
      <div class="btns">
        <div class="btn-wrap">
          <a id="anchor-new" class="btn green" href="{{CSV_NEW}}" download>
            <span class="left"><strong>New Files</strong></span>
            <span class="count">{{KPI_NEW}}</span>
          </a>
          <span class="info-icon" data-info="Files present in the latest production dump but absent in the previous one indicate new creations during this period in the SFDC production environment.">ⓘ</span>
        </div>

        <div class="btn-wrap">
          <a id="anchor-changed" class="btn orange" href="{{CSV_CHANGED}}" download>
            <span class="left"><strong>Changed Files</strong></span>
            <span class="count">{{KPI_CHANGED}}</span>
          </a>
          <span class="info-icon" data-info="Files present in both production dumps have undergone modifications during this period in the SFDC production environment.">ⓘ</span>
        </div>

        <div class="btn-wrap">
          <a id="anchor-removed" class="btn red" href="{{CSV_REMOVED}}" download>
            <span class="left"><strong>Removed Files</strong></span>
            <span class="count">{{KPI_REMOVED}}</span>
          </a>
          <span class="info-icon" data-info="Files missing from the latest production dump but present in the previous one indicate deletions made during this period in the SFDC production environment.">ⓘ</span>
        </div>

        <div class="btn-wrap">
          <a id="anchor-pmfr" class="btn blue" href="{{CSV_FULL}}" target="_blank" rel="noopener">
            <span class="left"><strong>Production Modified File Report</strong></span>
          </a>
          <span class="info-icon" data-info="This sheet is to be filled out by the Development, DevOps, or PS-Support teams. It should include information for each change, as specified in the sheet's columns.">ⓘ</span>
        </div>
      </div>
    </div>

    <!-- Quick Access -->
    <div class="card action">
      <h2>Quick Access</h2>
      <div class="btns">
        <a class="btn" href="{{PREVIOUS_LINK}}" target="_blank" title="Production dump taken on {{PREVIOUS_DATE_HUMAN}}">
          <span class="left"><strong>{{PREVIOUS_DATE_DASH}} Prod Dump</strong></span>
        </a>

        <a class="btn" href="{{LATEST_LINK}}" target="_blank" title="Production dump taken on {{LATEST_DATE_HUMAN}}">
          <span class="left"><strong>{{LATEST_DATE_DASH}} Prod Dump</strong></span>
        </a>

        <div class="btn-wrap">
          <a id="anchor-codecomp" class="btn" href="{{DIFF_HTML_LINK}}" target="_blank" rel="noopener">
            <span class="left"><strong>Code Comparison Report</strong></span>
          </a>
          <span class="info-icon" data-info="This report compares two production dumps and highlights only the differences, categorized by metadata type. It includes a count of changes for each metadata type.">ⓘ</span>
        </div>

        <div class="btn-wrap">
          <a id="anchor-log" class="btn" href="{{RUN_LOG_LINK}}" target="_blank" rel="noopener">
            <span class="left"><strong>Execution Log</strong></span>
          </a>
        </div>
      </div>
    </div>
  </section>
</main>

<!-- Reusable modal -->
<div class="modal-mask" id="infoMask" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="infoTitle">
    <h3 id="infoTitle">Info</h3>
    <p id="infoBody"></p>
    <div class="actions"><button class="btn-close" id="infoClose">Close</button></div>
  </div>
</div>

<footer>This is the end of report.</footer>

<script>
  // Info modal + optional time rendering
  (function(){
    const mask = document.getElementById('infoMask');
    const body = document.getElementById('infoBody');
    const title = document.getElementById('infoTitle');
    const closeBtn = document.getElementById('infoClose');

    function openModal(text, heading){
      title.textContent = heading || 'Info';
      body.textContent = text || '';
      mask.style.display = 'flex';
      mask.setAttribute('aria-hidden','false');
      closeBtn.focus();
    }
    function closeModal(){ mask.style.display='none'; mask.setAttribute('aria-hidden','true'); }

    document.addEventListener('click', function(e){
      const icon = e.target.closest('.info-icon');
      if(icon){
        const txt = icon.getAttribute('data-info') || '';
        let heading = 'Info';
        const left = icon.previousElementSibling?.querySelector?.('.left strong');
        if(left && left.textContent.trim()) heading = left.textContent.trim();
        openModal(txt, heading);
      }
      if(e.target === mask) closeModal();
    });
    closeBtn.addEventListener('click', closeModal);
    document.addEventListener('keydown', function(e){ if(e.key === 'Escape') closeModal(); });

    // show optional times if provided
    document.querySelectorAll('.time-badge').forEach(function(el){
      var t=(el.getAttribute('data-time')||'').trim();
      if(t && t.indexOf('{{')===-1){ el.textContent=' '+t; }
    });
  })();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SFDC Production Metadata Dump Comparison Reports</title>
<style>
  :root{
    --blue:#1d4ed8; --blue-deep:#1e40af;
    --gray:#6b7280; --ink:#0b0f19; --line:#e6e9ef; --bg:#f8fafc; --white:#fff;
    --radius:16px; --shadow:0 8px 24px rgba(0,0,0,.08),0 2px 6px rgba(0,0,0,.06);
  }
  *,*::before,*::after{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;background:var(--bg);color:var(--ink);
    font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;
    padding-bottom:40px; /* room for fixed footer */
  }

  /* Header */
  header{background:linear-gradient(135deg,#0b0f19 0%,var(--blue-deep) 100%);color:#fff}
  .h-inner{max-width:1100px;margin:0 auto;padding:16px 18px;display:flex;align-items:center;justify-content:space-between;gap:12px}
  .h-title{display:flex;flex-direction:column;gap:6px}
  .h-title h1{margin:0;font-size:clamp(18px,2.4vw,26px);font-weight:900;letter-spacing:.2px}
  .brand{display:flex;align-items:center;gap:10px}
  .brand img{height:32px;display:block;filter:drop-shadow(0 2px 2px rgba(0,0,0,.35))}

  /* Search */
  .searchbar{max-width:1100px;margin:14px auto 0;padding:0 18px}
  .searchbar input{
    width:100%;background:#fff;border:1px solid var(--line);border-radius:999px;
    padding:10px 14px;font-size:14px;outline:none;box-shadow:var(--shadow);
  }
  .searchbar input::placeholder{color:var(--gray)}

  /* Layout: single column (no sidebar) */
  main{max-width:1100px;margin:16px auto;padding:0 18px}

  /* Section headers */
  .month-title{
    display:inline-flex;align-items:center;gap:10px;
    font-weight:900;font-size:22px;margin:8px 0 6px 0;
  }
  .week-title{
    color:var(--blue-deep);font-weight:800;margin:10px 0 8px 0;
  }

  /* Cards grid (side-by-side within each week) */
  .cards{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(340px,1fr));
    gap:16px;
  }

  /* Card */
  .card{
    background:#fff;border:1px solid var(--line);border-radius:var(--radius);
    box-shadow:var(--shadow);padding:16px;display:flex;flex-direction:column;gap:10px;
  }
  .card h3{margin:0;font-size:18px;font-weight:900;line-height:1.25}
  .pill{
    display:inline-block;background:rgba(29,78,216,.10);border:1px solid rgba(29,78,216,.25);
    color:var(--blue);font-weight:800;border-radius:999px;padding:3px 8px;font-size:12px;
  }
  .meta{color:var(--gray);font-size:12px}
  .btn{
    display:inline-flex;align-items:center;justify-content:center;gap:8px;
    background:linear-gradient(180deg,#3b82f6 0%, #1d4ed8 100%); color:#fff; text-decoration:none;
    border-radius:12px; padding:12px 14px; font-weight:800; box-shadow:0 2px 6px rgba(0,0,0,.14);
    transition:transform .15s ease, box-shadow .15s ease, filter .15s ease;
  }
  .btn:hover{transform:translateY(-1px);box-shadow:0 8px 18px rgba(0,0,0,.18);filter:brightness(1.03)}
  .latest{background:#1d4ed8;color:#fff;border-radius:999px;padding:4px 10px;font-size:12px;font-weight:900}

  /* Footer fixed at bottom */
  footer{
    position:fixed;left:0;right:0;bottom:0;
    background:#0b0f19;color:#fff;text-align:center;font-size:12px;padding:6px 10px;
  }
  .muted{color:var(--gray)}
</style>
</head>
<body>
<header>
  <div class="h-inner">
    <div class="h-title">
      <h1>SFDC Production Metadata Dump Comparison Reports</h1>
    </div>
    <div class="brand">
      <img src="{{CADENCE_LOGO}}" alt="Cadence logo" />
    </div>
  </div>
</header>

<div class="searchbar">
  <input id="q" type="search" placeholder="Search by title, API version, or date…" />
</div>

<main id="mount">
  <!-- JS will render month/week groups and cards here -->
</main>

<footer>© Cadence — Master Index</footer>

<script id="reports-data" type="application/json">
{{REPORT_CARDS_JSON}}
</script>
<script>
(function(){
  const MONTHS = ["January","February","March","April","May","June","July","August","September","October","November","December"];
  const SHORT  = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

  /** Parse JSON injected by Python */
  function getReports(){
    try{
      const raw = document.getElementById('reports-data').textContent.trim();
      return raw ? JSON.parse(raw) : [];
    }catch(e){ console.warn('Bad REPORT_CARDS_JSON', e); return []; }
  }

  /** Compute Monday..Sunday for a given ISO date */
  function weekRange(iso){
    const d = new Date(iso+"T00:00:00");
    const day = (d.getDay()+6)%7; // 0=Mon
    const mon = new Date(d); mon.setDate(d.getDate()-day);
    const sun = new Date(mon); sun.setDate(mon.getDate()+6);
    function fmt(x){ return SHORT[x.getMonth()]+" "+x.getDate(); }
    return {key: mon.toISOString().slice(0,10), label: `Week of ${fmt(mon)} – ${fmt(sun)}`};
  }

  /** Group reports by month then by week */
  function groupReports(list){
    // sort newest first
    list.sort((a,b)=> (a.runDate < b.runDate ? 1 : -1));
    const latestDate = list.length ? list[0].runDate : null;

    const byMonth = new Map();
    for(const r of list){
      const d = new Date(r.runDate+"T00:00:00");
      const mkey = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;
      const w = weekRange(r.runDate);
      if(!byMonth.has(mkey)) byMonth.set(mkey, {year:d.getFullYear(), month:d.getMonth(), weeks:new Map()});
      const monthObj = byMonth.get(mkey);
      if(!monthObj.weeks.has(w.key)) monthObj.weeks.set(w.key, {label:w.label, items:[]});
      // mark latest
      r.__isLatest = (r.runDate === latestDate);
      monthObj.weeks.get(w.key).items.push(r);
    }
    return {latestDate, months:[...byMonth.entries()].sort((a,b)=> a[0]<b[0]?1:-1).map(([k,v])=>v)};
  }

  /** Render cards */
  function render(){
    const q = (document.getElementById('q').value || '').trim().toLowerCase();
    const all = getReports();
    const filtered = q ? all.filter(r=>{
      const h = `${r.title} ${r.apiVersion} ${r.runDate}`.toLowerCase();
      return h.includes(q);
    }) : all;

    const {months} = groupReports(filtered);
    const mount = document.getElementById('mount');
    mount.innerHTML = '';

    if(!months.length){
      mount.innerHTML = '<p class="muted">No reports found.</p>';
      return;
    }

    for(const m of months){
      const mWrap = document.createElement('section');
      const mTitle = document.createElement('div');
      mTitle.className = 'month-title';
      mTitle.textContent = `${MONTHS[m.month]} ${m.year}`;
      mWrap.appendChild(mTitle);

      // Sort weeks newest first
      const weekList = [...m.weeks.values()].sort((a,b)=>{
        // compare Monday keys which are ISO YYYY-MM-DD
        const ka = a.items[0]?.runDate || '0000-00-00';
        const kb = b.items[0]?.runDate || '0000-00-00';
        return ka < kb ? 1 : -1;
      });

      for(const w of weekList){
        const wTitle = document.createElement('div');
        wTitle.className = 'week-title';
        wTitle.textContent = w.label;
        mWrap.appendChild(wTitle);

        const grid = document.createElement('div');
        grid.className = 'cards';

        for(const r of w.items){
          const card = document.createElement('article');
          card.className = 'card';

          const h3 = document.createElement('h3');
          h3.textContent = r.title;
          card.appendChild(h3);

          const row = document.createElement('div');
          row.style.display='flex'; row.style.alignItems='center'; row.style.gap='10px';
          const api = document.createElement('span');
          api.className='pill'; api.textContent = `API ${r.apiVersion || '—'}`;
          row.appendChild(api);

          if(r.__isLatest){
            const latest = document.createElement('span');
            latest.className = 'latest'; latest.textContent = 'Latest';
            row.appendChild(latest);
          }
          card.appendChild(row);

          const meta = document.createElement('div');
          meta.className='meta';
          meta.textContent = `Run: ${r.runDate}`;
          card.appendChild(meta);

          const btn = document.createElement('a');
          btn.className='btn'; btn.href=r.detailHref; btn.textContent='Open Detailed Report';
          card.appendChild(btn);

          grid.appendChild(card);
        }

        mWrap.appendChild(grid);
      }

      mount.appendChild(mWrap);
    }
  }

  document.getElementById('q').addEventListener('input', render);
  render();
})();
</script>
</body>
</html>
